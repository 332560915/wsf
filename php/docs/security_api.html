<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
     <title>WS Security API</title>
  <link href="style/api_style.css" rel="stylesheet" type="text/css" media="all" />
</head>
<body>
<h1>WS Security API</h1>
    <h2>Predefined Classes For WS Security</h2>
    
    <h3 id="wspolicy">WSPolicy</h3>
    <h4 id="ws_policy_construct">Constructor</h4>
    <p>
        <strong>WSPolicy(mixed policy)</strong></p>
    <p>
        Construct a new WSPolicy Object. <br/>
        policy can be one of following.</p>
    <p>
        &nbsp; 1. XML string representing the corresponding policy.</p>
    <p>
        &nbsp; 2. DOM node representing the corresponding policy.</p>
    <p>
        &nbsp; 3. Array <br />
         &nbsp;&nbsp; &nbsp;&nbsp;Array of options can be specified using below syntax:<br />
           &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;  array("security"=>array of security options)<br />
             &nbsp;&nbsp;&nbsp;&nbsp;</p>    
    <p>
        When using WSPolicy, user can use a policy XML file to configue the security options
        to be used. When the user has a policy file, he or she can create a policy object using
        an XML string or a DOM node corresponding to that policy file. This is the recommended
        senario. In addition to that, WSO2 WSF/PHP security API provides the user to configure
        some minimum set of security features by using an options array that is accepted
        by WSPolicy constructor. Following is a description of the options that can be provided in the
        options array. Examples will be provided on policy files later in this document.</p>
    <p>
        &nbsp;</p>
    <p>
        <table border="1">
            <tr>
                <th id="policy_options">
                    Option
                </th>
                <th>
                    Data Type
                </th>
                <th style="width: 195px">
                    Value Domain
                </th>
                <th>
                    Default Value
                </th>
                <th>
                    Description
                </th>
            </tr>
            <tr>
                <td>
                    sign
                </td>
                <td>
                    string | boolean
                </td>
                <td style="width: 195px">
                    TRUE | "X509"
                </td>
                <td>
                    FALSE
                </td>
                <td >
                    Whether to sign the XML message or not. By default signing is not enabled.
                    <br clear="all" />
                    If specified "sign"=&gt;TRUE, the body part of the SOAP message will be signed using
                    X509 standard. 
                    <br clear="all" />
                    Signing will be done on the body part of the message. To sign other parts of
                    the message, a policy file should be used.
                </td>
            </tr>
            <tr>
                <td>
                    encrypt
                </td>
                <td>
                    string | boolean
                </td>
                <td style="width: 195px">
                    TRUE | "X509"
                    <br clear="all" />
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    Whether to encrypt the XML message or not. By default encryption is not enabled.
                    <br clear="all" />
                    If specified "encrypt"=&gt;TRUE, the body part of the SOAP message will be encrypted
                    using X509 Standard. 
                    <br clear="all" />
                    Encrypting will be done on the body part of the message. To encrypt headers, a policy
                    file should be used.
                </td>
            </tr>
            <tr>
                <td>
                    algorithmSuite
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    corresponds to Security Policy spec&nbsp; 7.1 [Algorithm Suite] definitions
                    <br clear="all" />
                </td>
                <td>
                    "Basic256Rsa15"
                </td>
                <td>
                    The symetric algorithm and asymetric algorithm will be derived from the algorithmSuite
                    string.                 </td>
            </tr>
            <tr>
                <td>
                    layout
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "Strict" | "Lax"
                </td>
                <td>
                    "Strict"
                </td>
                <td>
                    Defined the element order in the security header. 
                    These are defined in WS Security Policy Specification 1.1 section 7.7
                </td>
            </tr>
            <tr>
                <td>
                    includeTimeStamp
                </td>
                <td>
                    bool
                </td>
                <td style="width: 195px">
                    TRUE
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    If specified TRUE and user provided the ttl (time to live ) value when providing
                    security token object , timestamp will be used.
                </td>
            </tr>
            <tr>
                <td>
                    protectionOrder
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "EncryptBeforeSigning" | "SignBeforeEncrypt"
                </td>
                <td>
                    "EncryptBeforeSigning"
                </td>
                <td >
                    Order in which intergrity and confidentiality are applied to the message in cases
                    where both intergrity and confidentiality are required.
                </td>
            </tr>
            <tr>
                <td>
                    useUsernameToken
                </td>
                <td>
                    boolean
                </td>
                <td style="width: 195px">
                    TRUE
                </td>
                <td>
                    FALSE
                </td>
                <td>
                    If the necessary options are provided with the WSSecurityToken object and "useUsernameToken"=&gt;TRUE
                    , then UsernameToken will be enabled.
                </td>
            </tr>
            <tr>
                <td>
                    securityTokenReference
                </td>
                <td>
                    string
                </td>
                <td style="width: 195px">
                    "IssuerSerial" | "KeyIdentifier"|"EmbeddedToken"
                    <br clear="all" />
                    |"Thumbprint"| "Direct"
                    <br clear="all" />
                </td>
                <td>
                    "KeyIdentifier"
                    <br clear="all" />
                </td>
                <td>
                    Defines how security tokens are sent, when using encryption.
                    <br clear="all" />
                    If the user wishes to have security token references when signing, 
                    he or she should provide the appropriate policy file. 
                    <br clear="all" />
                </td>
            </tr>
        </table>
    </p>
    
    <h3 id="ws_security_token">WSSecurityToken</h3>
    <p>
        A PHP level object that logically represents security properties. This object will
        be used to specify the security properties from client or service.</p>
    <p>
        <b id="ws_security_token">WSSecurityToken::__construct(array of options)</b></p>
    <p>
        Options that can be provided in the options array are detailed in the following table.</p>
    <table class="confluenceTable" border="1">
        <tr>
            <th class="confluenceTh">
                Option
            </th>
            <th class="confluenceTh">
                Data Type
            </th>
            <th class="confluenceTh">
                Value Domain
            </th>
            <th class="confluenceTh">
                Default Value
            </th>
            <th class="confluenceTh" style="width: 415px">
                Description
            </th>
        </tr>
        <tr>
            <td class="confluenceTd">
                user
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                none
            </td>
            <td class="confluenceTd" style="width: 415px">
                Username
            </td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 21px">
                certificate</td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                none
            </td>
            <td class="confluenceTd" style="width: 415px; height: 21px">
                User's certificate to be used for signing, loaded 
                from the function get_cert_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                passwordType
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                "PlainText" |"Digest"
            </td>
            <td class="confluenceTd">
                Digest
            </td>
            <td class="confluenceTd" style="width: 415px">
                Password type used in UsernameToken
            </td>
        </tr>
        <tr>
            <td class="confluenceTd">
                password
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                none
            </td>
            <td class="confluenceTd" style="width: 415px">
                User's password used for UsernameToken
            </td>
        </tr>
        <tr>
            <td class="confluenceTd" style="height: 21px">
                privateKey
            </td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                string
            </td>
            <td class="confluenceTd" style="height: 21px">
                none
            </td>
            <td class="confluenceTd" style="width: 415px; height: 21px">
                User's private key, loaded from the function get_key_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                receiverCertificate</td>
            <td class="confluenceTd">
                string
            </td>
            <td class="confluenceTd">
                string&nbsp;<br clear="all" />
            </td>
            <td class="confluenceTd">
                none</td>
            <td class="confluenceTd" style="width: 415px">
                Receiver's certificate to be used for encryption, 
                locaded from the function get_cert_from_file()</td>
        </tr>
        <tr>
            <td class="confluenceTd">
                ttl
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                int
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                int
                <br clear="all" />
            </td>
            <td class="confluenceTd">
                360</td>
            <td class="confluenceTd" style="width: 415px">
                The time period within which the message would be valid in seconds
                <br clear="all" />
            </td>
        </tr>
        <tr>
            <td class="confluenceTd">
                password_callback</td>
            <td class="confluenceTd">
                string</td>
            <td class="confluenceTd">
                string</td>
            <td class="confluenceTd">
                none</td>
            <td class="confluenceTd" style="width: 415px">
                Name of the password callback function, which is a user defined function that accepts
                a username and returns the corresponding password.</td>
        </tr>
    </table>
    <br />
    
    <h2 id="ws_client_svc_options"> WSClient and WSService Options for Security</h2>
        <table border="1">
            <tr>
                <th id="policy_options">
                    Option
                </th>
                <th>
                    Data Type
                </th>
                <th style="width: 195px">
                    Value Domain
                </th>
                <th>
                    Default Value
                </th>
                <th>
                    Description
                </th>
            </tr>
            <tr>
                <td>
                    policy
                </td>
                <td>
                    WSPolicy
                </td>
                <td style="width: 195px">
                    WSPolicy instance
                </td>
                <td>
                    none
                </td>
                <td >
                    Policies to be used when when using WS-Security. 
                </td>
            </tr>
            <tr>
                <td>
                    securityToken
                </td>
                <td>
                    WSSecurityToken 
                </td>
                <td style="width: 195px">
                    WSSecurityToken instance
                </td>
                <td>
                    none
                </td>
                <td >
                    User specific security parameters to be used when using WS-Security. 
                </td>
            </tr>

        </table>

    <p>
        <br/>
        &nbsp;Only a common subset of security options could be provided as user options. For more complex
        senarios, user should provide the approriate policy file.</p>
        <br/>

    <h2 id="sec_policy_sample">WS-SecurityPolicy File Example</h2>
    <p>


<font face="Monospace">
&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&nbsp;<font color="#000000">xmlns</font>:<font color="#000000">wsp</font>='http:<font color="#808080"><i>//schemas.xmlsoap.org/ws/2004/09/policy'&gt;<br></i></font>
&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">ExactlyOne</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">All</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">AsymmetricBinding</font>&nbsp;<font color="#000000">xmlns</font>:<font color="#000000">sp</font>='http:<font color="#808080"><i>//schemas.xmlsoap.org/ws/2005/07/securitypolicy'&gt;<br></i></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">InitiatorToken</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">X509Token</font>&nbsp;<font color="#000000">sp</font>:<font color="#000000">IncludeToken</font>='<font color="#000000">http</font>:<font color="#808080"><i>//schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always'&gt;<br></i></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">WssX509V3Token10</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">X509Token</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">InitiatorToken</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">RecipientToken</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">X509Token</font>&nbsp;<font color="#000000">sp</font>:<font color="#000000">IncludeToken</font>='<font color="#000000">http</font>:<font color="#808080"><i>//schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Always'&gt;<br></i></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">WssX509V3Token10</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">X509Token</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">RecipientToken</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">AlgorithmSuite</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">Basic256Rsa15</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">AlgorithmSuite</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">Layout</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">Strict</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">Layout</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">IncludeTimestamp</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">EncryptBeforeSigning</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">OnlySignEntireHeadersAndBody</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">AsymmetricBinding</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">Wss10</font>&nbsp;<font color="#000000">xmlns</font>:<font color="#000000">sp</font>='http:<font color="#808080"><i>//schemas.xmlsoap.org/ws/2005/07/securitypolicy'&gt;<br></i></font>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;<font color="#000000">sp</font>:<font color="#000000">MustSupportRefIssuerSerial</font>&nbsp;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">sp</font>:<font color="#000000">Wss10</font>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">All</font>&gt;<br>
&nbsp;&nbsp;&lt;/<font color="#000000">wsp</font>:<font color="#000000">ExactlyOne</font>&gt;<br>
&lt;/<font color="#000000">wsp</font>:<font color="#000000">Policy</font>&gt;<br>
		</font>


</body>
</html>
